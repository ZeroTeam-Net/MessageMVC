# 1 异常处理
全局try—cache，保证异常不会上升到进程级别而导致服务崩溃。

# 2 cache中间件
根据配置读写缓存

# 3 鉴权中间件
根据token解析用户，校验权限

# 4 埋点中间件
记录请求ID，io数据以及执行时间等监控信息，发送到kafka，订阅者解析处理。

### 4.1 健康检查
根据接口调用频率，执行时间，返回值解析。判断服务可用性，并按规则报警。

### 4.2 链路追踪
根据requestID与父子子调用ID，组合出链路追踪层级数据。

### 4.3 用户分析
解析调用的API以及io数据，分析用户行为。


# 5 反向代理中间件
利用messageproducer，在非路由调用（即service的消息接收对象触发调用）的场景下，发出远程调用，从而实现反向代理，无需再实现每种传输协议的中间件

# 7 网关本地API处理
通过编写本地controler，使用apiExecuter即可。

# 8 安全中间件
通过发现异常调用，实时封堵。
- 短信轰炸机
- token排队
> 避免单个token频繁请求，通过redis分布式锁，将单token的并发请求变成排队操作。同时对过于频繁的调用直接返回503。

# 9 微信回调
通过服务名称过滤，支持支付回调，退款回调，公众号回调。
## 9.1 支付回调
解析参数，写入消息队列后，回复微信。

## 9.2 公众号回调
> 可移植盛派的相关代码，实现轻量级应用。他们的代码实在太重了。

- 解析参数
- apiExecuter直接执行，返回到微信
- 写入消息队列，按配置返回到微信
- 远程RPC调用，结果返回微信。